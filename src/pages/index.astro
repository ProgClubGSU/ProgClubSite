---
import { getEvents, renderPortableText } from "@/lib/sanity.js";
import Hero from "@/components/Hero.astro";
import Breadcrumb from "@/components/Breadcrumb.astro";
import Section from "@/components/Section.astro";
import BlogPostCard from "@/components/BlogPostCard.astro";
import Layout from "@/layouts/Layout.astro";
import { KNOWN_TECH, ABOUT_ME, SITE_TITLE } from "@/consts";

const events = await getEvents();

// Helper function to extract plain text from description
function getPlainTextExcerpt(description) {
  if (typeof description === 'string') return description;
  if (!description || !Array.isArray(description)) return '';
  
  // Extract text from block content
  return description
    .filter(block => block._type === 'block')
    .map(block => 
      block.children
        ?.filter(child => child._type === 'span')
        ?.map(span => span.text)
        ?.join('') || ''
    )
    .join(' ')
    .substring(0, 150) + '...';
}
---

<Layout title={SITE_TITLE}>
  <Hero />
  <Section
    title="Events"
    className={"bg-gradient-to-b from-black/70 from-[5%] to-black via-black"}
  >
    <div class="w-full grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
      {
        events.map((event) => (
          <BlogPostCard
            slug={event.slug.current}
            title={event.title}
            excerpt={getPlainTextExcerpt(event.description)}
            date={event.date?.isTBD ? null : (event.date?.value ? new Date(event.date.value) : null)}
            resources={event.resources}
          />
        ))
      }
    </div>
    <div class="w-full flex justify-center mt-8">
      <a 
        href="/events" 
        class="inline-flex items-center px-8 py-4 bg-gradient-to-br from-white/[0.001] to-white/[0.01] border-2 border-white/30 hover:border-green-400 text-white font-medium rounded-lg transition-all duration-300 ease-in-out hover:shadow-[0_0_20px_rgba(34,197,94,0.3)] hover:shadow-green-400/30 hover:scale-105 group"
      >
        <span class="mr-2 text-green-400 group-hover:text-green-300 transition-colors duration-300">‚ùØ</span>
        <span>See All Events</span>
      </a>
    </div>
  </Section>
  {/* Technologies section - commented out for now, may be used in the future */}
  {/* <Section title="Technologies I Know" full_screen={false}>
    <div class="w-full grid place-items-center">
      <div
        class="w-full gap-4 flex flex-wrap px-3 max-w-xl text-lg justify-center"
      >
        {KNOWN_TECH.map((x) => <Breadcrumb title={x} />)}
      </div>
    </div>
  </Section> */}
  <Section title="About">
    <div class="w-full grid place-items-center">
      <div
        class="max-w-4xl text-xl md:text-lg opacity-90 text-center justify-evenly"
      >
        <p>{ABOUT_ME}</p>
      </div>
    </div>
  </Section>
</Layout>
